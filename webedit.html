<!doctype html>
<title> DaWS Editor </title>
<meta charset="UTF-8">
<button onclick= batch() >testing</button> <button onclick="openAndFillWindow()">Open New Window</button>
<input type="file" id="file-input" multiple accept=".css, .xhtml, .html" />
<div id="message"></div>
<h2> filecontent </h2>
<pre editable id="file-content"></pre>
<h2> css </h2>
<pre editable id="file-css"></pre>
<pre editable id="file-html"></pre>
<script>
const fileInput = document.getElementById("file-input");
 const messageDisplay = document.getElementById("message");

fileInput.addEventListener("change", handleFileSelection);

function readFileAsText(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();

    // Resolve the promise when the file is loaded
    reader.onload = () => resolve(reader.result);

    // Reject the promise if an error occurs
    reader.onerror = () => reject(reader.error);

    // Start reading the file
    reader.readAsText(file);
  });
}

function handleFileSelection(event) {
    selectedFiles = Array.from(event.target.files);
  
    // Map each file to a promise that reads it as text
    const promises = selectedFiles.map(readFileAsText);

    //   wait for all promises to resolve
    Promise.all(promises)
    .then((results) => {
      // process the fetched files
      results.forEach((content, index) => { type=selectedFiles[index].type;
      fileContentDisplay=document.getElementById(type=="text/css"?"file-css":"file-content"); 
      fileContentDisplay.textContent =content;
    });
  } )
  .catch((error) => {
     console.error('Error reading files:', error);
  } )
}


// Displays a message to the user
function showMessage(message, type) {
  messageDisplay.textContent = message;
  messageDisplay.style.color = type === "error" ? "red" : "green";
}

function openAndFillWindow() {

    test5();
    let newWindow = window.open("", "generatedWindow", "width=700,height=500,resizable=yes,scrollbars=yes");

    if (newWindow) { // Check if the window was successfully opened (not blocked by pop-up blocker)
        let generatedHTML = document.getElementById("file-html").textContent;
        console.log(generatedHTML);
        newWindow.document.write(generatedHTML);
        newWindow.document.close();
    } else {
        alert("Pop-up blocked! Please allow pop-ups for this site.");
    }
}

// You would typically call this function from an event, e.g., a button click
// <button onclick="openAndFillWindow()">Open New Window</button>

  


</script> 
 
 
 <script src = "template.js" > </script> <script>
function addencodings (a) {exports.addencodings (a) ; if (inprogress == 0) exports.reclaimspace () ;}
function blockseqtype () {exports.blockseqtype () ; if (inprogress == 0) exports.reclaimspace () ;}
function reclaimspace () {exports.reclaimspace () ; if (inprogress == 0) exports.reclaimspace () ;}
function processbody (a, b) {exports.processbody (a, b) ; if (inprogress == 0) exports.reclaimspace () ;}
function handleerror (a) {exports.handleerror (a) ; if (inprogress == 0) exports.reclaimspace () ;}
function randomintimp (a) {exports.randomintimp (a) ; if (inprogress == 0) exports.reclaimspace () ;}
function jsmakepair (a, b) {exports.jsmakepair (a, b) ; if (inprogress == 0) exports.reclaimspace () ;}
function allocatespace3 (a) {exports.allocatespace3 (a) ; if (inprogress == 0) exports.reclaimspace () ;}
function webedit () {exports.webedit () ; if (inprogress == 0) exports.reclaimspace () ;}
function HTTPwords (a, b) {exports.HTTPwords (a, b) ; if (inprogress == 0) exports.reclaimspace () ;}
function batch () {exports.batch () ; if (inprogress == 0) exports.reclaimspace () ;}
function test5 () {exports.test5 () ; if (inprogress == 0) exports.reclaimspace () ;}

pageinit ("webedit", webedit) ; </script> 