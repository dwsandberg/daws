<!doctype html>
<title> Daws Editor </title>
<link rel="icon" type="image/png" href="/daws/favicon.png">
<meta charset="UTF-8">
<style>  
#message{color:red;}
.tools  { background-color:lightgray;}
pre {
  white-space: pre-wrap;
}
</style> 
<div class=tools >
<input hidden type="file" id="file-input" multiple accept=".css, .xhtml, .html" />
<label for="file-input"> upload </label>  | </span>
<a   > <span  id=f45>  </span>   </a> 
 | </span>
<span id="message"></span>
</div>
<h2> filecontent </h2>
<pre contenteditable=true id="file-content"></pre>
<h2> css </h2>
<pre contenteditable=true id="file-css"></pre>
<pre   id="file-html"></pre>
<script>
const fileInput = document.getElementById("file-input");
 const messageDisplay = document.getElementById("message");
const mytest=   document.getElementById("f45");

 mytest.addEventListener("contextmenu", download);
 mytest.addEventListener("click", download);

fileInput.addEventListener("change", handleFileSelection);

function readFileAsText(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();

    // Resolve the promise when the file is loaded
    reader.onload = () => resolve(reader.result);

    // Reject the promise if an error occurs
    reader.onerror = () => reject(reader.error);

    // Start reading the file
    reader.readAsText(file);
  });
}

async function handleFileSelection(event) {
    selectedFiles = Array.from(event.target.files);
  
    // Map each file to a promise that reads it as text
    const promises = selectedFiles.map(readFileAsText);

    //   wait for all promises to resolve
     await Promise.all(promises)
    .then((results) => {
      // process the fetched files
      results.forEach( (content, index) => { 
      type=selectedFiles[index].type;
      storeId=type=="text/css"?"file-css":"file-content"
      if (storeId=="file-content") document.getElementById("f45").innerHTML=selectedFiles[index].name;
      fileContentDisplay=document.getElementById( storeId); 
      fileContentDisplay.textContent =content;
      console.log("resolve"+index+" type:"+type+" storeid:" +storeId);
    });
  } )
  .catch((error) => {
     console.error('Error reading files:', error);
  } )
    batch();
}


// Displays a message to the user
function showMessage(message, type) {
  messageDisplay.textContent = message;
  messageDisplay.style.color = type === "error" ? "red" : "green";
}

function download() {
 // to save files on the client machine, we use the context menu. which allows the downloaded files to be
 // saved amywhere.
   element= event.target;
    filename=element.textContent;
  
    test5();
   let generatedHTML = document.getElementById("file-html").textContent;
   element.parentNode.setAttribute('href', 'data:text/html;charset=utf-8,' + encodeURIComponent(generatedHTML ));
   
   element.parentNode.setAttribute('download', filename);

}



</script> 
 
 
 <script src = "template.js" > </script> <script>
function addencodings (a) {exports.addencodings (a) ; if (inprogress == 0) exports.reclaimspace () ;}
function blockseqtype () {exports.blockseqtype () ; if (inprogress == 0) exports.reclaimspace () ;}
function reclaimspace () {exports.reclaimspace () ; if (inprogress == 0) exports.reclaimspace () ;}
function processbody (a, b) {exports.processbody (a, b) ; if (inprogress == 0) exports.reclaimspace () ;}
function handleerror (a) {exports.handleerror (a) ; if (inprogress == 0) exports.reclaimspace () ;}
function randomintimp (a) {exports.randomintimp (a) ; if (inprogress == 0) exports.reclaimspace () ;}
function jsmakepair (a, b) {exports.jsmakepair (a, b) ; if (inprogress == 0) exports.reclaimspace () ;}
function allocatespace3 (a) {exports.allocatespace3 (a) ; if (inprogress == 0) exports.reclaimspace () ;}
function webedit () {exports.webedit () ; if (inprogress == 0) exports.reclaimspace () ;}
function HTTPwords (a, b) {exports.HTTPwords (a, b) ; if (inprogress == 0) exports.reclaimspace () ;}
function batch () {exports.batch () ; if (inprogress == 0) exports.reclaimspace () ;}
function test5 () {exports.test5 () ; if (inprogress == 0) exports.reclaimspace () ;}

pageinit ("webedit", webedit) ; </script> 